<!DOCTYPE html>
<html lang="en">

<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Settings | SmartCity Insight</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bitter:wght@400;600;700&family=Work+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'styles.css' %}">
</head>

<body class="settings-page">
    {% include 'navbar.html' %}

    <div class="settings-wrapper">
        <header class="settings-header">
            <a href="{% url 'profile' %}" class="back-link">
                ‚Üê Back to Profile
            </a>
            <h1>Account Settings</h1>
            <p class="subtitle">Manage your account information and preferences</p>
        </header>

        {% if messages %}
        <div class="message-container">
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                <span class="alert-icon">
                    {% if message.tags == 'success' %}‚úì{% else %}‚ö†{% endif %}
                </span>
                <span><strong>{{ message }}</strong></span>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <div class="settings-content">
            <div class="settings-main">
                <form method="POST" class="settings-form" id="settingsForm">
                    {% csrf_token %}

                    <div class="security-notice">
                        <span class="icon">üîí</span>
                        <div class="content">
                            <strong>Secure Information</strong>
                            <p>Your data is encrypted and protected. Only you can view and modify your personal information.</p>
                        </div>
                    </div>

                    <section class="settings-section">
                        <h2 class="section-title">
                            <span class="section-icon">üë§</span>
                            Account Information
                        </h2>

                        <div class="form-group">
                            <label for="id_username">Username <span style="color: var(--error-color);">*</span></label>
                            {{ user_form.username }}
                            <span class="input-hint">Your unique username for logging into the system</span>
                        </div>

                        <div class="form-group">
                            <label for="id_email">Email Address <span style="color: var(--error-color);">*</span></label>
                            {{ user_form.email }}
                            <span class="input-hint">üîí Email cannot be changed for security reasons</span>
                        </div>
                    </section>

                    <section class="settings-section">
                        <h2 class="section-title">
                            <span class="section-icon">üìù</span>
                            Personal Information
                        </h2>

                        <div class="form-group">
                            <label for="id_name">Full Name <span style="color: var(--error-color);">*</span></label>
                            {{ profile_form.name }}
                            <span class="input-hint">Your complete name as it should appear on complaints</span>
                        </div>

                        <div class="form-group">
                            <label for="id_mobile">Mobile Number</label>
                            {{ profile_form.mobile }}
                            <span class="input-hint">10-digit mobile number for contact purposes</span>
                        </div>

                        <div class="form-group">
                            <label for="id_age">Age</label>
                            {{ profile_form.age }}
                            <span class="input-hint">Your age in years</span>
                        </div>
                    </section>

                    <section class="settings-section">
                        <h2 class="section-title">
                            <span class="section-icon">üìç</span>
                            Location Information
                        </h2>

                        <div class="form-group">
                            <label for="id_locality">Locality / Area</label>
                            {{ profile_form.locality }}
                            <span class="input-hint">Select your residential area - ward number will be assigned automatically</span>
                        </div>
                        
                        {% if user.profile.ward_number %}
                        <div class="form-group">
                            <label>Assigned Ward Number</label>
                            <input type="text" value="Ward {{ user.profile.ward_number }}" disabled class="form-control">
                            <span class="input-hint">Automatically assigned based on your locality</span>
                        </div>
                        {% endif %}
                    </section>

                    <div class="form-actions">
                        <a href="{% url 'profile' %}" class="btn btn-secondary">
                            Cancel
                        </a>
                        <button type="submit" class="btn btn-primary btn-large">
                            Save Changes
                        </button>
                    </div>
                </form>
            </div>

            <aside class="settings-sidebar">
                <div class="profile-stats">
                    <h3>üìä Your Activity</h3>
                    <div class="stat-item">
                        <span class="stat-label">Account Role</span>
                        <span class="stat-value">{{ user.profile.role }}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Member Since</span>
                        <span class="stat-value">{{ user.date_joined|date:"M Y" }}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Ward Number</span>
                        <span class="stat-value">{{ user.profile.ward_number|default:"N/A" }}</span>
                    </div>
                </div>

                <div class="info-card">
                    <h3>üí° Profile Tips</h3>
                    <ul>
                        <li>Keep your email updated for important notifications</li>
                        <li>Add your mobile number for faster communication</li>
                        <li>Set accurate locality for relevant complaint tracking</li>
                        <li>Update your profile regularly for better service</li>
                    </ul>
                </div>

                <div class="info-card">
                    <h3>üîê Privacy & Security</h3>
                    <ul>
                        <li>Your personal data is never shared publicly</li>
                        <li>Only authorized ward officials can view contact info</li>
                        <li>All connections are encrypted with SSL</li>
                        <li>Change your password regularly for security</li>
                    </ul>
                </div>

                <div class="info-card">
                    <h3>‚ùì Need Help?</h3>
                    <ul>
                        <li>Contact support for account issues</li>
                        <li>Report bugs or suggestions</li>
                        <li>Check FAQ for common questions</li>
                        <li>Email: support@smartcity.gov.in</li>
                    </ul>
                </div>
            </aside>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('settingsForm');
            const mobileInput = document.getElementById('id_mobile');
            const ageInput = document.getElementById('id_age');

            if (mobileInput) {
                mobileInput.addEventListener('input', function(e) {
                    this.value = this.value.replace(/[^0-9]/g, '');
                    if (this.value.length > 10) {
                        this.value = this.value.slice(0, 10);
                    }
                });
            }

            if (ageInput) {
                ageInput.addEventListener('input', function(e) {
                    this.value = this.value.replace(/[^0-9]/g, '');
                    if (parseInt(this.value) > 120) {
                        this.value = '120';
                    }
                });
            }

            form.addEventListener('submit', function(e) {
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.textContent = 'Saving...';
                submitBtn.disabled = true;
            });

            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                setTimeout(() => {
                    alert.style.opacity = '0';
                    alert.style.transform = 'translateY(-10px)';
                    setTimeout(() => alert.remove(), 300);
                }, 5000);
            });
        });
    </script>

</body>

</html>